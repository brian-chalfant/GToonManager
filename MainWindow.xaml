<Window x:Class="GToonManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:GToonManager.ViewModels"
        xmlns:controls="clr-namespace:GToonManager.Controls"
        xmlns:converters="clr-namespace:GToonManager.Converters"
        mc:Ignorable="d"
        Title="⚔️ GToon Manager - D&amp;D 5E Character Creator ⚔️" 
        Height="1200" Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource WindowBackground}">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:ValueToVisibilityConverter x:Key="ValueToVisibilityConverter"/>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <converters:AbilityScoreBorderConverter x:Key="AbilityScoreBorderConverter"/>
        <converters:AbilityScoreBorderThicknessConverter x:Key="AbilityScoreBorderThicknessConverter"/>
        <converters:AbilityScoreBonusTextConverter x:Key="AbilityScoreBonusTextConverter"/>
        <converters:AbilityScoreBonusVisibilityConverter x:Key="AbilityScoreBonusVisibilityConverter"/>
        <converters:AbilityScoreBorderMultiConverter x:Key="AbilityScoreBorderMultiConverter"/>
        <converters:AbilityScoreBorderThicknessMultiConverter x:Key="AbilityScoreBorderThicknessMultiConverter"/>
        <converters:AbilityScoreBonusTextMultiConverter x:Key="AbilityScoreBonusTextMultiConverter"/>
        <converters:AbilityScoreBonusVisibilityMultiConverter x:Key="AbilityScoreBonusVisibilityMultiConverter"/>
        
        <!-- Medieval Theme Resources for Application - Use DynamicResource for theme switching -->
        <!-- These will be dynamically updated by the ThemeService -->
        
        <!-- Medieval Tab Control Styles -->
        <Style TargetType="TabControl" x:Key="MedievalTabControlStyle">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="TabStripPlacement" Value="Top"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabControl">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Tab Header Area -->
                            <Border Grid.Row="0" Background="{DynamicResource DarkRed}" 
                                   BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="3,3,3,0"
                                   CornerRadius="8,8,0,0" Margin="0,0,0,0">
                                <TabPanel x:Name="HeaderPanel" IsItemsHost="True" Margin="5,5,5,0"/>
                            </Border>
                            
                            <!-- Tab Content Area - No border, just background -->
                            <Grid Grid.Row="1">
                                <ContentPresenter x:Name="PART_SelectedContentHost" 
                                                ContentSource="SelectedContent" 
                                                Margin="0"/>
                            </Grid>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style TargetType="TabItem" x:Key="MedievalTabItemStyle">
            <Setter Property="FontFamily" Value="Garamond"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryGold}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Stretch"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="Border" Background="{TemplateBinding Background}"
                               BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="2,2,2,0"
                               CornerRadius="8,8,0,0" Margin="{TemplateBinding Margin}">
                            <ContentPresenter x:Name="ContentSite" ContentSource="Header"
                                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                            Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <!-- Normal State -->
                            <Trigger Property="IsSelected" Value="False">
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource PanelBlue}"/>
                                <Setter TargetName="Border" Property="BorderThickness" Value="2,2,2,0"/>
                                <Setter Property="Foreground" Value="{DynamicResource PrimaryGold}"/>
                                <Setter TargetName="Border" Property="Opacity" Value="0.7"/>
                            </Trigger>
                            
                            <!-- Selected State -->
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource PrimaryRed}"/>
                                <Setter TargetName="Border" Property="BorderThickness" Value="3,3,3,0"/>
                                <Setter Property="Foreground" Value="{DynamicResource PrimaryGold}"/>
                                <Setter TargetName="Border" Property="Opacity" Value="1"/>
                                <Setter TargetName="Border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="{Binding Source={x:Static Application.Current}, Path=Resources[PrimaryGold].Color}" 
                                                        BlurRadius="8" ShadowDepth="0" Opacity="0.6"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            
                            <!-- Hover State -->
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                    <Condition Property="IsSelected" Value="False"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource DarkRed}"/>
                                <Setter TargetName="Border" Property="BorderThickness" Value="2,2,2,0"/>
                                <Setter TargetName="Border" Property="Opacity" Value="0.9"/>
                                <Setter TargetName="Border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="{Binding Source={x:Static Application.Current}, Path=Resources[PrimaryGold].Color}" 
                                                        BlurRadius="4" ShadowDepth="0" Opacity="0.4"/>
                                    </Setter.Value>
                                </Setter>
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Global Medieval Styles for all tabs -->
        <Style TargetType="TextBox" x:Key="MedievalTextBoxStyle">
            <Setter Property="Background" Value="{DynamicResource ControlBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryRed}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryGold}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="FontFamily" Value="Garamond"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                            <ScrollViewer x:Name="PART_ContentHost" Focusable="false" 
                                          HorizontalScrollBarVisibility="Hidden" 
                                          VerticalScrollBarVisibility="Hidden"
                                          Padding="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="border" Property="BorderThickness" Value="3"/>
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#D4AF37" BlurRadius="8" ShadowDepth="0"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#FFD700"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style TargetType="ComboBox" x:Key="MedievalComboBoxStyle">
            <Setter Property="Background" Value="{DynamicResource ControlBackground}"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryRed}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryGold}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="FontFamily" Value="Garamond"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
        </Style>
        
        <Style TargetType="TextBlock" x:Key="MedievalLabelStyle">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryRed}"/>
            <Setter Property="FontFamily" Value="Garamond"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
        
        <Style TargetType="Button" x:Key="MedievalButtonStyle">
            <Setter Property="Background" Value="{DynamicResource PrimaryRed}"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryGold}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryGold}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="FontFamily" Value="Garamond"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Typography.Capitals" Value="AllSmallCaps"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderThickness" Value="3"/>
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#D4AF37" BlurRadius="5" ShadowDepth="0"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style TargetType="Border" x:Key="MedievalPanelStyle">
            <Setter Property="Background" Value="{DynamicResource PanelBackground}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryGold}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="15"/>
        </Style>
        
        <Style TargetType="GroupBox" x:Key="MedievalGroupBoxStyle">
            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryGold}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="FontFamily" Value="Garamond"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryRed}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Border Grid.Row="0" Background="{DynamicResource PrimaryRed}" 
                                   BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="2,2,2,0" 
                                   CornerRadius="8,8,0,0" Padding="15,8">
                                <ContentPresenter ContentSource="Header" 
                                                 TextBlock.Foreground="{DynamicResource PrimaryGold}"
                                                 TextBlock.FontFamily="Garamond"
                                                 TextBlock.FontWeight="Bold"
                                                 TextBlock.FontSize="16"/>
                            </Border>
                            <Border Grid.Row="1" Background="{DynamicResource MedievalBackground}" 
                                   BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="2,0,2,2" 
                                   CornerRadius="0,0,8,8">
                                <ContentPresenter Margin="{TemplateBinding Padding}"/>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style TargetType="Border" x:Key="AbilityPanelStyle">
            <Setter Property="Background" Value="{DynamicResource PanelBlue}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryGold}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Margin" Value="6"/>
            <Setter Property="Padding" Value="10"/>
        </Style>
        
        <!-- Medieval Menu Style -->
        <Style TargetType="Menu" x:Key="MedievalMenuStyle">
            <Setter Property="Background" Value="{DynamicResource DarkRed}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryGold}"/>
            <Setter Property="BorderThickness" Value="0,0,0,2"/>
            <Setter Property="FontFamily" Value="Garamond"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
        
        <!-- Medieval MenuItem Style -->
        <Style TargetType="MenuItem" x:Key="MedievalMenuItemStyle">
            <Setter Property="Foreground" Value="{DynamicResource PrimaryGold}"/>
            <Setter Property="FontFamily" Value="Garamond"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                BorderBrush="Transparent" BorderThickness="1" CornerRadius="4">
                            <Grid>
                                <ContentPresenter ContentSource="Header" RecognizesAccessKey="True" 
                                                  Margin="{TemplateBinding Padding}" 
                                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                                <Popup x:Name="PART_Popup" AllowsTransparency="True" Focusable="False" 
                                       IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                       PopupAnimation="Fade" Placement="Bottom">
                                    <Border Background="{DynamicResource DarkRed}" BorderBrush="{DynamicResource PrimaryGold}" 
                                            BorderThickness="2" CornerRadius="4">
                                        <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Cycle"/>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource PrimaryGold}"/>
                                <Setter Property="Foreground" Value="{DynamicResource PrimaryRed}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Medieval Header Button Style -->
        <Style TargetType="Button" x:Key="MedievalHeaderButtonStyle">
            <Setter Property="Background" Value="{DynamicResource PrimaryRed}"/>
            <Setter Property="Foreground" Value="{DynamicResource PrimaryGold}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource PrimaryGold}"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="FontFamily" Value="Garamond"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Typography.Capitals" Value="AllSmallCaps"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource PrimaryGold}"/>
                                <Setter Property="Foreground" Value="{DynamicResource PrimaryRed}"/>
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#D4AF37" BlurRadius="10" ShadowDepth="0"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FFD700"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding NewCharacterCommand}"/>
        <KeyBinding Key="O" Modifiers="Ctrl" Command="{Binding LoadCharacterCommand}"/>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveCharacterCommand}"/>
        <KeyBinding Key="S" Modifiers="Ctrl+Shift" Command="{Binding SaveCharacterAsCommand}"/>
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Style="{StaticResource MedievalMenuStyle}" Height="30" BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="0,0,0,2">
            <MenuItem Header="⚔️ _File" Style="{StaticResource MedievalMenuItemStyle}" Padding="12,6">
                <MenuItem Header="🆕 _New Character" Style="{StaticResource MedievalMenuItemStyle}" Command="{Binding NewCharacterCommand}" InputGestureText="Ctrl+N"/>
                <MenuItem Header="📂 _Open Character..." Style="{StaticResource MedievalMenuItemStyle}" Command="{Binding LoadCharacterCommand}" InputGestureText="Ctrl+O"/>
                <MenuItem Header="💾 _Save Character" Style="{StaticResource MedievalMenuItemStyle}" Command="{Binding SaveCharacterCommand}" InputGestureText="Ctrl+S"/>
                <MenuItem Header="💾 Save Character _As..." Style="{StaticResource MedievalMenuItemStyle}" Command="{Binding SaveCharacterAsCommand}" InputGestureText="Ctrl+Shift+S"/>
                <Separator Background="{StaticResource PrimaryGold}"/>
                <MenuItem Header="📤 _Export" Style="{StaticResource MedievalMenuItemStyle}">
                    <MenuItem Header="🌐 Export to _HTML..." Style="{StaticResource MedievalMenuItemStyle}" Command="{Binding ExportToHtmlCommand}"/>
                    <MenuItem Header="📄 Export to _PDF..." Style="{StaticResource MedievalMenuItemStyle}" Command="{Binding ExportToPdfCommand}"/>
                </MenuItem>
                <MenuItem Header="🔧 _Debug" Style="{StaticResource MedievalMenuItemStyle}">
                    <MenuItem Header="🔍 Discover PDF _Fields..." Style="{StaticResource MedievalMenuItemStyle}" Command="{Binding DiscoverPdfFieldsCommand}"/>
                    <MenuItem Header="🔬 _Analyze PDF Structure..." Style="{StaticResource MedievalMenuItemStyle}" Command="{Binding AnalyzePdfCommand}"/>
                    <MenuItem Header="🧪 Create _Test PDF..." Style="{StaticResource MedievalMenuItemStyle}" Command="{Binding CreateTestPdfCommand}"/>
                </MenuItem>
                <Separator Background="{StaticResource PrimaryGold}"/>
                <MenuItem Header="⚙️ _Settings..." Style="{StaticResource MedievalMenuItemStyle}" Command="{Binding ShowSettingsCommand}"/>
                <Separator Background="{StaticResource PrimaryGold}"/>
                <MenuItem Header="❌ E_xit" Style="{StaticResource MedievalMenuItemStyle}" Command="{Binding ExitApplicationCommand}" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="❓ _Help" Style="{StaticResource MedievalMenuItemStyle}" Padding="12,6">
                <MenuItem Header="ℹ️ _About GToon Manager..." Style="{StaticResource MedievalMenuItemStyle}" Command="{Binding ShowAboutCommand}"/>
            </MenuItem>
        </Menu>

        <!-- Header -->
        <Border Grid.Row="1" Background="{DynamicResource PrimaryRed}" Padding="20" BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="0,0,0,3">
            <Border BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="2" CornerRadius="8" Padding="15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="⚔️ GToon Manager ⚔️" FontSize="28" FontWeight="Bold" 
                                   Foreground="{DynamicResource PrimaryGold}" FontFamily="Garamond" Margin="0,0,20,0"/>
                        <TextBlock Text="🏰 D&amp;D 5E Character Creator 🏰" FontSize="16" 
                                   Foreground="{DynamicResource PrimaryGold}" FontFamily="Garamond" 
                                   VerticalAlignment="Center" Opacity="0.9"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Content="🆕 New Character" Command="{Binding NewCharacterCommand}" 
                                Style="{StaticResource MedievalHeaderButtonStyle}" Margin="5"/>
                        <Button Content="📂 Load Character" Command="{Binding LoadCharacterCommand}" 
                                Style="{StaticResource MedievalHeaderButtonStyle}" Margin="5"/>
                        <Button Content="💾 Save Character" Command="{Binding SaveCharacterCommand}" 
                                Style="{StaticResource MedievalHeaderButtonStyle}" Margin="5"/>
                        <Button Content="🌐 Export HTML" Command="{Binding ExportToHtmlCommand}" 
                                Style="{StaticResource MedievalHeaderButtonStyle}" Margin="5"/>
                        <Button Content="📄 Export PDF" Command="{Binding ExportToPdfCommand}" 
                                Style="{StaticResource MedievalHeaderButtonStyle}" Margin="5"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Border>

        <!-- Main Content -->
        <TabControl Grid.Row="2" Margin="0" Background="{DynamicResource ControlBackground}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <!-- Basic Info Tab -->
            <TabItem Header="⚔️ Basic Info" Style="{StaticResource MedievalTabItemStyle}" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch">
                
                <Grid Background="{DynamicResource MedievalBackground}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                            
                            <!-- Title Bar -->
                            <Border Grid.Row="0" Background="{DynamicResource PrimaryRed}" Padding="20,15">
                                <Border BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="1">
                                    <TextBlock Text="⚔️ Character Basic Information ⚔️" 
                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                               Foreground="{DynamicResource PrimaryGold}"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               Padding="10,5">
                                        <TextBlock.Effect>
                                            <DropShadowEffect Color="Black" BlurRadius="3" ShadowDepth="2"/>
                                        </TextBlock.Effect>
                                    </TextBlock>
                                </Border>
                            </Border>
                            
                            <!-- Content Area -->
                            <Grid Grid.Row="1" Margin="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Character Name (Top Left) -->
                                <Border Grid.Row="0" Grid.Column="0" Style="{DynamicResource MedievalPanelStyle}" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="🏰 Character Name" Style="{DynamicResource MedievalLabelStyle}" 
                                                   FontSize="16" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                        <TextBox Text="{Binding CurrentCharacter.Name}" Style="{DynamicResource MedievalTextBoxStyle}" 
                                                 FontSize="16" FontWeight="Bold"/>
                                    </StackPanel>
                                </Border>

                                <!-- Player Name (Top Right) -->
                                <Border Grid.Row="0" Grid.Column="1" Style="{DynamicResource MedievalPanelStyle}" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="👤 Player Name" Style="{DynamicResource MedievalLabelStyle}" 
                                                   FontSize="16" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                        <TextBox Text="{Binding CurrentCharacter.PlayerName}" Style="{DynamicResource MedievalTextBoxStyle}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Species & Subspecies (Middle Left) -->
                                <Border Grid.Row="1" Grid.Column="0" Style="{StaticResource MedievalPanelStyle}" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="🧝 Species &amp; Subspecies" Style="{StaticResource MedievalLabelStyle}" 
                                                   FontSize="16" HorizontalAlignment="Center" Margin="0,0,0,15"/>
                                        
                                        <!-- Species Selection -->
                                        <StackPanel Margin="0,0,0,10">
                                            <TextBlock Text="Species:" FontFamily="Garamond" FontWeight="Bold" 
                                                      Foreground="{DynamicResource PrimaryRed}" FontSize="12" 
                                                      HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                            <ComboBox ItemsSource="{Binding Species}" 
                                                      SelectedItem="{Binding CurrentCharacter.Species}"
                                                      DisplayMemberPath="Name" Style="{DynamicResource MedievalComboBoxStyle}"/>
                                        </StackPanel>
                                        
                                        <!-- Subspecies Selection -->
                                        <StackPanel>
                                            <TextBlock Text="Subspecies:" FontFamily="Garamond" FontWeight="Bold" 
                                                      Foreground="{DynamicResource PrimaryRed}" FontSize="12" 
                                                      HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                            <ComboBox ItemsSource="{Binding CurrentCharacter.AvailableSubspecies}" 
                                                      SelectedItem="{Binding CurrentCharacter.Subspecies}"
                                                      DisplayMemberPath="Name" Style="{DynamicResource MedievalComboBoxStyle}"
                                                      IsEnabled="{Binding CurrentCharacter.HasSubspecies}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <!-- Background Selection (Middle Right) -->
                                <Border Grid.Row="1" Grid.Column="1" Style="{StaticResource MedievalPanelStyle}" Padding="15">
                                    <StackPanel>
                                        <TextBlock Text="📜 Background" Style="{StaticResource MedievalLabelStyle}" 
                                                   FontSize="16" HorizontalAlignment="Center" Margin="0,0,0,15"/>
                                        
                                        <!-- Current Background Display -->
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
                                            <!-- Show current background when set, or configured background name when in configuration -->
                                            <TextBlock FontFamily="Garamond" FontWeight="Bold" FontSize="12" 
                                                      Foreground="{StaticResource PrimaryRed}" TextAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                        <Style.Triggers>
                                                            <!-- Show when there's a current background -->
                                                            <DataTrigger Binding="{Binding CurrentCharacter.Background, Converter={StaticResource BooleanToVisibilityConverter}}" Value="Visible">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                <Setter Property="Text" Value="{Binding CurrentCharacter.Background.Name, StringFormat='Current: {0}'}"/>
                                                            </DataTrigger>
                                                            <!-- Show when there's a selected background for configuration (and no current background) -->
                                                            <MultiDataTrigger>
                                                                <MultiDataTrigger.Conditions>
                                                                    <Condition Binding="{Binding CurrentCharacter.Background}" Value="{x:Null}"/>
                                                                    <Condition Binding="{Binding SelectedBackground, Converter={StaticResource BooleanToVisibilityConverter}}" Value="Visible"/>
                                                                </MultiDataTrigger.Conditions>
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                <Setter Property="Text" Value="{Binding SelectedBackground.Name, StringFormat='Configuring: {0}'}"/>
                                                            </MultiDataTrigger>
                                                            <!-- Show when there's an applied background choice (even if current background is temporarily null) -->
                                                            <MultiDataTrigger>
                                                                <MultiDataTrigger.Conditions>
                                                                    <Condition Binding="{Binding CurrentCharacter.Background}" Value="{x:Null}"/>
                                                                    <Condition Binding="{Binding SelectedBackground}" Value="{x:Null}"/>
                                                                    <Condition Binding="{Binding HasAppliedBackgroundAbilities}" Value="True"/>
                                                                </MultiDataTrigger.Conditions>
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                <Setter Property="Text" Value="{Binding CurrentCharacter.BackgroundAbilityScoreChoice.Background.Name, StringFormat='Applied: {0}'}"/>
                                                            </MultiDataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                            <!-- Checkmark for applied background abilities -->
                                            <TextBlock Text=" ✅" FontSize="14" VerticalAlignment="Center" Margin="5,0,0,0"
                                                      Visibility="{Binding HasAppliedBackgroundAbilities, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                      ToolTip="Background abilities have been successfully applied"/>
                                        </StackPanel>
                                        
                                        <!-- Background Selection -->
                                        <ComboBox ItemsSource="{Binding Backgrounds}" 
                                                  SelectedItem="{Binding CurrentCharacter.Background}"
                                                  DisplayMemberPath="Name" Style="{StaticResource MedievalComboBoxStyle}"/>
                                    </StackPanel>
                                </Border>

                                <!-- Background Ability Score Selection (Bottom - Full Width) -->
                                <Border Grid.Row="2" Grid.ColumnSpan="2" Style="{StaticResource MedievalPanelStyle}" Padding="20"
                                       Visibility="{Binding HasBackgroundAbilityScoreOptions, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <StackPanel>
                                        <TextBlock Text="⚡ Background Abilities Configuration" Style="{StaticResource MedievalLabelStyle}" 
                                                   FontSize="16" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                        
                                        <!-- Background Selection Info -->
                                        <Border Background="{StaticResource PrimaryRed}" BorderBrush="{StaticResource PrimaryGold}" 
                                               BorderThickness="2" CornerRadius="6" Padding="10" Margin="0,0,0,20">
                                            <TextBlock Text="{Binding SelectedBackground.Name, StringFormat='Configuring abilities for: {0}'}" 
                                                      FontFamily="Garamond" FontWeight="Bold" FontSize="14" 
                                                      Foreground="{StaticResource PrimaryGold}" TextAlignment="Center"/>
                                        </Border>
                                        
                                        <!-- Improvement Option Selection -->
                                        <StackPanel Margin="0,0,0,20">
                                            <TextBlock Text="Step 1: Choose your improvement option" FontFamily="Garamond" FontWeight="Bold" 
                                                      Foreground="{StaticResource PrimaryRed}" FontSize="14" Margin="0,0,0,10" TextAlignment="Center"/>
                                            <ComboBox ItemsSource="{Binding BackgroundAbilityScoreOptions}"
                                                      SelectedItem="{Binding SelectedBackgroundImprovementOption}"
                                                      DisplayMemberPath="Description" Style="{StaticResource MedievalComboBoxStyle}" 
                                                      MaxWidth="500"/>
                                        </StackPanel>
                                        
                                        <!-- Ability Score Selection Area -->
                                        <StackPanel Visibility="{Binding HasBackgroundImprovementOption, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <!-- Description -->
                                            <TextBlock Text="{Binding BackgroundImprovementOptionDescription}" 
                                                      FontFamily="Garamond" FontStyle="Italic" FontSize="12" Typography.Capitals="AllSmallCaps"
                                                      Foreground="{StaticResource PrimaryRed}" TextAlignment="Center" Margin="0,0,0,20"/>
                                            
                                            <!-- Available Ability Scores with Selection Indicators -->
                                            <StackPanel Margin="0,0,0,20">
                                                <TextBlock Text="Step 2: Select ability scores to improve" FontFamily="Garamond" FontWeight="Bold" 
                                                          Foreground="{StaticResource PrimaryRed}" FontSize="14" Margin="0,0,0,5" TextAlignment="Center"/>
                                                <TextBlock Text="(First selection gets +2, second selection gets +1)" FontFamily="Garamond" FontStyle="Italic" 
                                                          Foreground="Gray" FontSize="12" Margin="0,0,0,15" TextAlignment="Center"/>
                                                
                                                <!-- Available Ability Scores with Border -->
                                                <ItemsControl ItemsSource="{Binding AvailableAbilityScoresForBackground}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border CornerRadius="8" Margin="12" Padding="4">
                                                                <Border.BorderBrush>
                                                                    <MultiBinding Converter="{StaticResource AbilityScoreBorderMultiConverter}">
                                                                        <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext"/>
                                                                        <Binding Path="."/>
                                                                        <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext.BackgroundAbilityScoreSelections"/>
                                                                    </MultiBinding>
                                                                </Border.BorderBrush>
                                                                <Border.BorderThickness>
                                                                    <MultiBinding Converter="{StaticResource AbilityScoreBorderThicknessMultiConverter}">
                                                                        <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext"/>
                                                                        <Binding Path="."/>
                                                                        <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext.BackgroundAbilityScoreSelections"/>
                                                                    </MultiBinding>
                                                                </Border.BorderThickness>
                                                                <StackPanel>
                                                                    <Button 
                                                                        Content="{Binding}"
                                                                        Command="{Binding DataContext.AddBackgroundAbilityScoreCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                        CommandParameter="{Binding}"
                                                                        Style="{StaticResource MedievalButtonStyle}"
                                                                        FontSize="16" Padding="25,15" MinWidth="140"/>
                                                                    <TextBlock FontFamily="Garamond" FontWeight="Bold" FontSize="14"
                                                                               Foreground="#2E8B57" HorizontalAlignment="Center" Margin="0,5,0,0">
                                                                        <TextBlock.Text>
                                                                            <MultiBinding Converter="{StaticResource AbilityScoreBonusTextMultiConverter}">
                                                                                <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext"/>
                                                                                <Binding Path="."/>
                                                                                <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext.BackgroundAbilityScoreSelections"/>
                                                                            </MultiBinding>
                                                                        </TextBlock.Text>
                                                                        <TextBlock.Visibility>
                                                                            <MultiBinding Converter="{StaticResource AbilityScoreBonusVisibilityMultiConverter}">
                                                                                <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext"/>
                                                                                <Binding Path="."/>
                                                                                <Binding RelativeSource="{RelativeSource AncestorType=Window}" Path="DataContext.BackgroundAbilityScoreSelections"/>
                                                                            </MultiBinding>
                                                                        </TextBlock.Visibility>
                                                                    </TextBlock>
                                                                </StackPanel>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                                
                                                <!-- Selection Status Display -->
                                                <Border Background="#E8F4FD" BorderBrush="#3498db" BorderThickness="2" 
                                                       CornerRadius="8" Padding="15" Margin="0,15,0,0"
                                                       Visibility="{Binding BackgroundAbilityScoreSelections.Count, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                    <StackPanel>
                                                        <TextBlock Text="Current Selections:" FontFamily="Garamond" FontWeight="Bold" 
                                                                  FontSize="14" Foreground="{StaticResource PrimaryRed}" 
                                                                  HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                                        <ItemsControl ItemsSource="{Binding BackgroundAbilityScoreSelections}">
                                                            <ItemsControl.ItemsPanel>
                                                                <ItemsPanelTemplate>
                                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                                                                </ItemsPanelTemplate>
                                                            </ItemsControl.ItemsPanel>
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <Border Background="White" BorderBrush="{StaticResource PrimaryGold}" 
                                                                           BorderThickness="2" CornerRadius="6" Margin="5" Padding="12,8">
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <TextBlock Text="{Binding AbilityScore}" FontFamily="Garamond" FontWeight="Bold" 
                                                                                      Foreground="{StaticResource PrimaryRed}" FontSize="16"/>
                                                                            <TextBlock Text=" +" FontFamily="Garamond" Margin="5,0" 
                                                                                      Foreground="{StaticResource PrimaryRed}" FontSize="16"/>
                                                                            <TextBlock Text="{Binding Improvement}" FontFamily="Garamond" FontWeight="Bold" 
                                                                                      Foreground="#2E8B57" FontSize="18"/>
                                                                            <Button Content="✖" Margin="10,0,0,0"
                                                                                    Command="{Binding DataContext.RemoveBackgroundAbilityScoreCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                                    CommandParameter="{Binding}"
                                                                                    Background="#e74c3c" Foreground="White"
                                                                                    BorderThickness="0" Padding="6,4" FontSize="10"
                                                                                    ToolTip="Remove this selection"/>
                                                                        </StackPanel>
                                                                    </Border>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                            
                                            <!-- Apply Button -->
                                            <Border Background="{StaticResource PrimaryGold}" BorderBrush="{StaticResource PrimaryRed}" 
                                                   BorderThickness="2" CornerRadius="8" Padding="2">
                                                <Button Content="🗡️ Apply Background Abilities" 
                                                        Command="{Binding ApplyBackgroundCommand}"
                                                        Style="{StaticResource MedievalButtonStyle}"
                                                        FontSize="16" Padding="25,12" Width="300"
                                                        IsEnabled="{Binding CanApplyBackgroundSelection}"
                                                        ToolTip="Apply selected background abilities to your character"/>
                                            </Border>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </Grid>
                </Grid>
            </TabItem>

            <!-- Multiclassing Tab -->
            <TabItem Header="🛡️ Classes &amp; Multiclassing" Style="{StaticResource MedievalTabItemStyle}" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch">
                <Grid Background="{DynamicResource MedievalBackground}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Title Bar -->
                            <Border Grid.Row="0" Background="{DynamicResource PrimaryRed}" Padding="20,15">
                                <Border BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="1">
                                    <TextBlock Text="⚔️ Character Classes &amp; Multiclassing ⚔️" 
                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                               Foreground="{DynamicResource PrimaryGold}"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               Padding="10,5">
                                        <TextBlock.Effect>
                                            <DropShadowEffect Color="Black" BlurRadius="3" ShadowDepth="2"/>
                                        </TextBlock.Effect>
                                    </TextBlock>
                                </Border>
                            </Border>
                            
                            <!-- Content Area -->
                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Current Classes -->
                        <GroupBox Grid.Row="0" Header="⚔️ Current Classes" Padding="15" Margin="0,0,0,20" Style="{DynamicResource MedievalGroupBoxStyle}">
                            <StackPanel>
                                <TextBlock Text="{Binding CurrentCharacter.ClassSummary}" Style="{DynamicResource MedievalLabelStyle}"
                                          Margin="0,0,0,15" HorizontalAlignment="Center"/>
                                
                                <ItemsControl ItemsSource="{Binding CurrentCharacter.ClassLevels}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Style="{DynamicResource MedievalPanelStyle}" Margin="0,5"
                                                   Background="White" BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="2"
                                                   CornerRadius="8" Padding="15">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    
                                                    <StackPanel Grid.Column="0">
                                                        <TextBlock Text="{Binding ClassWithSubclass}" Style="{DynamicResource MedievalLabelStyle}"/>
                                                        <TextBlock Text="{Binding CharacterClass.Description}" 
                                                                  FontFamily="Garamond" FontStyle="Italic" 
                                                                  Foreground="{DynamicResource PrimaryRed}" Opacity="0.7"/>
                                                        <TextBlock Text="{Binding ChosenSubclass.Description}" 
                                                                  FontFamily="Garamond" FontStyle="Italic" 
                                                                  Foreground="{DynamicResource PrimaryRed}" Opacity="0.8"
                                                                  Margin="0,5,0,0" TextWrapping="Wrap"
                                                                  Visibility="{Binding HasSubclass, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                    </StackPanel>
                                                    
                                                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0">
                                                        <TextBlock Text="Level:" Style="{DynamicResource MedievalLabelStyle}" FontSize="14" 
                                                                  VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                        <TextBox Text="{Binding Level}" Width="50" 
                                                                Style="{DynamicResource MedievalTextBoxStyle}" Padding="5"/>
                                                    </StackPanel>
                                                    
                                                    <TextBlock Grid.Column="2" Text="{Binding CharacterClass.HitDie, StringFormat='⚀ Hit Die: d{0}'}" 
                                                              Style="{DynamicResource MedievalLabelStyle}" FontSize="14"
                                                              VerticalAlignment="Center" Margin="20,0"/>
                                                    
                                                    <StackPanel Grid.Column="3" Orientation="Vertical" VerticalAlignment="Center">
                                                        <Button Content="⚔️ Choose Subclass" 
                                                                Command="{Binding DataContext.ChooseSubclassCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                CommandParameter="{Binding}"
                                                                Style="{DynamicResource MedievalButtonStyle}"
                                                                Background="#4169E1" FontSize="10" Padding="10,4" Margin="0,0,0,5"
                                                                Visibility="{Binding CanChooseSubclass, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                        <Button Content="🗡️ Remove Class" 
                                                                Command="{Binding DataContext.RemoveClassCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                CommandParameter="{Binding}"
                                                                Style="{DynamicResource MedievalButtonStyle}"
                                                                Background="#B22222" FontSize="10" Padding="10,4"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                
                                <!-- No classes message -->
                                <TextBlock Text="🏰 No classes added yet. Add your first class below. ⚔️" 
                                          FontFamily="Garamond" FontStyle="Italic" FontSize="16"
                                          Foreground="{DynamicResource PrimaryRed}" Opacity="0.8"
                                          HorizontalAlignment="Center" Margin="20">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CurrentCharacter.ClassLevels.Count}" Value="0">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </GroupBox>

                        <!-- Add New Class -->
                        <GroupBox Grid.Row="1" Header="⚔️ Add New Class" Padding="15" Style="{DynamicResource MedievalGroupBoxStyle}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Class Selection -->
                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,15,15">
                                    <TextBlock Text="🗡️ Select Class" Style="{DynamicResource MedievalLabelStyle}" 
                                              HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                    <ComboBox ItemsSource="{Binding Classes}" 
                                              SelectedItem="{Binding SelectedClassToAdd}"
                                              DisplayMemberPath="Name" Style="{DynamicResource MedievalComboBoxStyle}"/>
                                </StackPanel>

                                <!-- Level Selection -->
                                <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,15,15">
                                    <TextBlock Text="⭐ Starting Level" Style="{DynamicResource MedievalLabelStyle}" 
                                              HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                    <TextBox Text="{Binding SelectedLevelToAdd}" 
                                            Style="{DynamicResource MedievalTextBoxStyle}"/>
                                </StackPanel>

                                <!-- Add Button -->
                                <Button Grid.Row="0" Grid.Column="2" Content="⚔️ Add Class" 
                                        Command="{Binding AddClassCommand}"
                                        Style="{DynamicResource MedievalButtonStyle}"
                                        Background="{DynamicResource PrimaryRed}" Padding="20,12"
                                        VerticalAlignment="Bottom" Margin="0,0,0,15"/>

                                <!-- Class Description -->
                                <Border Grid.Row="1" Grid.ColumnSpan="3" Style="{DynamicResource MedievalPanelStyle}">
                                    <StackPanel>
                                        <TextBlock Text="{Binding SelectedClassToAdd.Name}" Style="{DynamicResource MedievalLabelStyle}" 
                                                  HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                        <TextBlock Text="{Binding SelectedClassToAdd.Description}" 
                                                  FontFamily="Garamond" FontStyle="Italic" 
                                                  Foreground="{DynamicResource PrimaryRed}" Opacity="0.9"
                                                  TextWrapping="Wrap" Margin="0,0,0,15"/>
                                        <Grid Margin="0,0,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="{Binding SelectedClassToAdd.HitDie, StringFormat='⚀ Hit Die: d{0}'}" 
                                                      Style="{DynamicResource MedievalLabelStyle}" FontSize="14" 
                                                      HorizontalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="{Binding SelectedClassToAdd.PrimaryAbility, StringFormat='💪 Primary Ability: {0}'}" 
                                                      Style="{DynamicResource MedievalLabelStyle}" FontSize="14"
                                                      HorizontalAlignment="Center"/>
                                        </Grid>
                                    </StackPanel>
                                </Border>

                                <!-- Skill Selection Section -->
                                <Border Grid.Row="2" Grid.ColumnSpan="3" Style="{DynamicResource MedievalPanelStyle}"
                                       Background="#FFF8DC" BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="2" 
                                       Margin="0,15,0,0"
                                       Visibility="{Binding HasSkillChoices, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <StackPanel>
                                        <TextBlock Text="{Binding SkillChoicePrompt}" Style="{DynamicResource MedievalLabelStyle}"
                                                  HorizontalAlignment="Center" Margin="0,0,0,15"/>
                                        
                                        <!-- Available Skills -->
                                        <TextBlock Text="⚔️ Available Skills:" Style="{DynamicResource MedievalLabelStyle}" 
                                                  FontSize="14" Margin="0,0,0,10"/>
                                        <ItemsControl ItemsSource="{Binding AvailableSkillChoices}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel Orientation="Horizontal"/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Button Content="{Binding}" 
                                                           Command="{Binding DataContext.AddSkillCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                           CommandParameter="{Binding}"
                                                           Style="{DynamicResource MedievalButtonStyle}"
                                                           Background="{DynamicResource PrimaryRed}" FontSize="12" Padding="10,6" Margin="3" Width="75"
                                                           IsEnabled="{Binding DataContext.CanAddMoreSkills, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                        
                                        <!-- Selected Skills -->
                                        <TextBlock Text="🛡️ Selected Skills:" Style="{DynamicResource MedievalLabelStyle}" 
                                                  FontSize="14" Margin="0,15,0,10"/>
                                        <ItemsControl ItemsSource="{Binding SelectedSkills}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel Orientation="Horizontal"/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="{DynamicResource PrimaryRed}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                           BorderThickness="2" Margin="3" Padding="10,6" CornerRadius="6">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{Binding SkillName}" Foreground="{DynamicResource PrimaryGold}" 
                                                                      FontFamily="Garamond" FontWeight="Bold"
                                                                      VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                            <Button Content="✖" 
                                                                   Command="{Binding DataContext.RemoveSkillCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                   CommandParameter="{Binding}"
                                                                   Background="Transparent" Foreground="{DynamicResource PrimaryGold}" 
                                                                   BorderThickness="0" Padding="2" 
                                                                   FontWeight="Bold" FontSize="10"/>
                                                        </StackPanel>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                        
                                        <TextBlock Text="📜 No skills selected" FontFamily="Garamond" FontStyle="Italic" 
                                                  Foreground="{DynamicResource PrimaryRed}" Opacity="0.7" FontSize="14"
                                                   Margin="0,5,0,0" HorizontalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding SelectedSkills.Count}" Value="0">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                                <!-- Total Level Summary -->
                                <Border Grid.Row="3" Grid.ColumnSpan="3" Background="{DynamicResource PrimaryRed}" 
                                       BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="2" 
                                       CornerRadius="8" Padding="15,15,0,0">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <TextBlock Text="👑 Total Character Level: " FontFamily="Garamond" FontSize="16" FontWeight="Bold"
                                                  Foreground="{DynamicResource PrimaryGold}"/>
                                        <TextBlock Text="{Binding CurrentCharacter.Level}" FontFamily="Garamond" FontSize="20" FontWeight="Bold" 
                                                  Foreground="#FFD700"/>
                                        <TextBlock Text=" | ⚡ Proficiency Bonus: " FontFamily="Garamond" FontSize="16" FontWeight="Bold" 
                                                  Foreground="{DynamicResource PrimaryGold}" Margin="20,0,0,0"/>
                                        <TextBlock Text="{Binding CurrentCharacter.ProficiencyBonus, StringFormat='+{0}'}" 
                                                  FontFamily="Garamond" FontSize="20" FontWeight="Bold" 
                                                  Foreground="#FFD700"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </GroupBox>
                    </Grid>
                </ScrollViewer>
                </Grid>
            </TabItem>

            <!-- Generate Ability Scores Tab -->
            <TabItem Header="🎲 Generate Ability Scores" Style="{StaticResource MedievalTabItemStyle}" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch">
                <Grid Background="{DynamicResource MedievalBackground}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                                                        <!-- Buttons Section -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,16,0,16">
                                <Button Content="Roll 4d6 (Drop Lowest)" 
                                        Command="{Binding OpenRollingCommand}"
                                        Style="{DynamicResource MedievalButtonStyle}"/>
                                <Button Content="Standard Array" 
                                        Command="{Binding OpenStandardArrayCommand}"
                                        Style="{DynamicResource MedievalButtonStyle}"/>
                                <Button Content="Point Buy" 
                                        Command="{Binding OpenPointBuyCommand}"
                                        Style="{DynamicResource MedievalButtonStyle}"/>
                                <Button Content="Manual Entry" 
                                        Command="{Binding OpenFreeEntryCommand}"
                                        Style="{DynamicResource MedievalButtonStyle}"/>
                                <Button Content="⚔️ Manage ASI" 
                                        Command="{Binding ManageASICommand}"
                                        Style="{DynamicResource MedievalButtonStyle}"
                                        Margin="20,0,0,0"/>
                            </StackPanel>
                            <!-- Title Bar -->
                            <Border Grid.Row="1" Background="{DynamicResource PrimaryRed}" Padding="20,15">
                                <Border BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="1">
                                    <TextBlock Text="Generate Ability Scores" 
                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                               Foreground="{DynamicResource PrimaryGold}"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"
                                               Padding="10,5">
                                        <TextBlock.Effect>
                                            <DropShadowEffect Color="Black" BlurRadius="3" ShadowDepth="2"/>
                                        </TextBlock.Effect>
                                    </TextBlock>
                                </Border>
                            </Border>
                            
                                        <!-- Ability Score Panels with ScrollViewer -->
            <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Margin="20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                                
                                <!-- Strength -->
                                <Border Grid.Row="0" Grid.Column="0">
                                    <Border.Style>
                                        <Style TargetType="Border" BasedOn="{StaticResource AbilityPanelStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CurrentCharacter.HasGeneratedAbilityScores}" Value="False">
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*"/>
                                            <ColumnDefinition Width="2*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Image on Left -->
                                        <Image Grid.Column="0" Source="pack://application:,,,/Pictures/20250609_2239_Goliath Barbarian Strength_remix_01jxbv72fcexdtra1k4fxyzs15.png" 
                                               Stretch="UniformToFill" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5"/>
                                        
                                        <!-- Scores on Right -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="5">
                                            <!-- Base Score Display -->
                                            <Border Background="{DynamicResource PrimaryRed}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                    BorderThickness="2" Width="100" Height="70" CornerRadius="6" Margin="0,0,0,10">
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="Base" FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center" Opacity="0.8"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.AbilityScores.Strength, FallbackValue='—'}" 
                                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                            
                                            <!-- Modifier Sources Display -->
                                            <StackPanel Orientation="Vertical" Width="100">
                                                <!-- Species Enhancement Display -->
                                                <Border BorderBrush="#8A2BE2" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#F5E8FF"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.StrengthSpeciesBonus}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="Species" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#8A2BE2" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.StrengthSpeciesBonus, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#8A2BE2" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- Background Enhancement Display -->
                                                <Border BorderBrush="#2E8B57" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#E8F5E8"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.StrengthBackgroundBonus}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="Background" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#2E8B57" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.StrengthBackgroundBonus, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#2E8B57" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- ASI Enhancement Display -->
                                                <Border BorderBrush="#FF6347" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#FFF0E8"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.StrengthASI}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.StrengthASI}" Value="{x:Null}">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="ASI" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#FF6347" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.StrengthASI, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#FF6347" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                            
                                            <!-- Final Score Display -->
                                            <Border Background="#FFD700" BorderBrush="#B8860B" BorderThickness="2" Width="100" Height="60" CornerRadius="6">
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="Final" FontFamily="Garamond" FontSize="12" FontWeight="Bold"
                                                               Foreground="#8B4513" HorizontalAlignment="Center" Opacity="0.8"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.StrengthTotal, FallbackValue='—'}" 
                                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                                               Foreground="#8B4513" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                
                                <!-- Dexterity -->
                                <Border Grid.Row="0" Grid.Column="1">
                                    <Border.Style>
                                        <Style TargetType="Border" BasedOn="{StaticResource AbilityPanelStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CurrentCharacter.HasGeneratedAbilityScores}" Value="False">
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*"/>
                                            <ColumnDefinition Width="2*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Image on Left -->
                                        <Image Grid.Column="0" Source="pack://application:,,,/Pictures/20250609_2256_Archer Dexterity_remix_01jxbw6vheffqvs00fvagyk8es.png" 
                                               Stretch="UniformToFill" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5"/>
                                        
                                        <!-- Scores on Right -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="5">
                                            <!-- Base Score Display -->
                                            <Border Background="{DynamicResource PrimaryRed}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                    BorderThickness="2" Width="100" Height="70" CornerRadius="6" Margin="0,0,0,10">
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="Base" FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center" Opacity="0.8"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.AbilityScores.Dexterity, FallbackValue='—'}" 
                                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                            
                                            <!-- Modifier Sources Display -->
                                            <StackPanel Orientation="Vertical" Width="100">
                                                <!-- Species Enhancement Display -->
                                                <Border BorderBrush="#8A2BE2" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#F5E8FF"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.DexteritySpeciesBonus}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="Species" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#8A2BE2" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.DexteritySpeciesBonus, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#8A2BE2" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- Background Enhancement Display -->
                                                <Border BorderBrush="#2E8B57" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#E8F5E8"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.DexterityBackgroundBonus}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="Background" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#2E8B57" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.DexterityBackgroundBonus, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#2E8B57" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- ASI Enhancement Display -->
                                                <Border BorderBrush="#FF6347" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#FFF0E8"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.DexterityASI}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.DexterityASI}" Value="{x:Null}">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="ASI" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#FF6347" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.DexterityASI, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#FF6347" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                            
                                            <!-- Final Score Display -->
                                            <Border Background="#FFD700" BorderBrush="#B8860B" BorderThickness="2" Width="100" Height="60" CornerRadius="6">
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="Final" FontFamily="Garamond" FontSize="12" FontWeight="Bold"
                                                               Foreground="#8B4513" HorizontalAlignment="Center" Opacity="0.8"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.DexterityTotal, FallbackValue='—'}" 
                                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                                               Foreground="#8B4513" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                
                                <!-- Constitution -->
                                <Border Grid.Row="1" Grid.Column="0">
                                    <Border.Style>
                                        <Style TargetType="Border" BasedOn="{StaticResource AbilityPanelStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CurrentCharacter.HasGeneratedAbilityScores}" Value="False">
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*"/>
                                            <ColumnDefinition Width="2*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Image on Left -->
                                        <Image Grid.Column="0" Source="pack://application:,,,/Pictures/20250609_2257_Constitution Knight_remix_01jxbw7kftf3t83m5xn62vzc8e.png" 
                                               Stretch="UniformToFill" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5"/>
                                        
                                        <!-- Scores on Right -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="5">
                                            <!-- Base Score Display -->
                                            <Border Background="{DynamicResource PrimaryRed}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                    BorderThickness="2" Width="100" Height="70" CornerRadius="6" Margin="0,0,0,10">
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="Base" FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center" Opacity="0.8"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.AbilityScores.Constitution, FallbackValue='—'}" 
                                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                            
                                            <!-- Modifier Sources Display -->
                                            <StackPanel Orientation="Vertical" Width="100">
                                                <!-- Species Enhancement Display -->
                                                <Border BorderBrush="#8A2BE2" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#F5E8FF"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.ConstitutionSpeciesBonus}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="Species" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#8A2BE2" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.ConstitutionSpeciesBonus, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#8A2BE2" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- Background Enhancement Display -->
                                                <Border BorderBrush="#2E8B57" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#E8F5E8"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.ConstitutionBackgroundBonus}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="Background" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#2E8B57" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.ConstitutionBackgroundBonus, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#2E8B57" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- ASI Enhancement Display -->
                                                <Border BorderBrush="#FF6347" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#FFF0E8"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.ConstitutionASI}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.ConstitutionASI}" Value="{x:Null}">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="ASI" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#FF6347" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.ConstitutionASI, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#FF6347" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                            
                                            <!-- Final Score Display -->
                                            <Border Background="#FFD700" BorderBrush="#B8860B" BorderThickness="2" Width="100" Height="60" CornerRadius="6">
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="Final" FontFamily="Garamond" FontSize="12" FontWeight="Bold"
                                                               Foreground="#8B4513" HorizontalAlignment="Center" Opacity="0.8"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.ConstitutionTotal, FallbackValue='—'}" 
                                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                                               Foreground="#8B4513" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                
                                <!-- Intelligence -->
                                <Border Grid.Row="1" Grid.Column="1">
                                    <Border.Style>
                                        <Style TargetType="Border" BasedOn="{StaticResource AbilityPanelStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CurrentCharacter.HasGeneratedAbilityScores}" Value="False">
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*"/>
                                            <ColumnDefinition Width="2*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Image on Left -->
                                        <Image Grid.Column="0" Source="pack://application:,,,/Pictures/20250609_2245_Wizard of Intelligence_remix_01jxbvjv10evs946etkr9f1ww3.png" 
                                               Stretch="UniformToFill" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5"/>
                                        
                                        <!-- Scores on Right -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="5">
                                            <!-- Base Score Display -->
                                            <Border Background="{DynamicResource PrimaryRed}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                    BorderThickness="2" Width="100" Height="70" CornerRadius="6" Margin="0,0,0,10">
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="Base" FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center" Opacity="0.8"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.AbilityScores.Intelligence, FallbackValue='—'}" 
                                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                            
                                            <!-- Modifier Sources Display -->
                                            <StackPanel Orientation="Vertical" Width="100">
                                                <!-- Species Enhancement Display -->
                                                <Border BorderBrush="#8A2BE2" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#F5E8FF"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.IntelligenceSpeciesBonus}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="Species" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#8A2BE2" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.IntelligenceSpeciesBonus, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#8A2BE2" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- Background Enhancement Display -->
                                                <Border BorderBrush="#2E8B57" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#E8F5E8"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.IntelligenceBackgroundBonus}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="Background" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#2E8B57" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.IntelligenceBackgroundBonus, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#2E8B57" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- ASI Enhancement Display -->
                                                <Border BorderBrush="#FF6347" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#FFF0E8"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.IntelligenceASI}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.IntelligenceASI}" Value="{x:Null}">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="ASI" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#FF6347" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.IntelligenceASI, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#FF6347" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                            
                                            <!-- Final Score Display -->
                                            <Border Background="#FFD700" BorderBrush="#B8860B" BorderThickness="2" Width="100" Height="60" CornerRadius="6">
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="Final" FontFamily="Garamond" FontSize="12" FontWeight="Bold"
                                                               Foreground="#8B4513" HorizontalAlignment="Center" Opacity="0.8"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.IntelligenceTotal, FallbackValue='—'}" 
                                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                                               Foreground="#8B4513" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                
                                <!-- Wisdom -->
                                <Border Grid.Row="2" Grid.Column="0">
                                    <Border.Style>
                                        <Style TargetType="Border" BasedOn="{StaticResource AbilityPanelStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CurrentCharacter.HasGeneratedAbilityScores}" Value="False">
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*"/>
                                            <ColumnDefinition Width="2*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Image on Left -->
                                        <Image Grid.Column="0" Source="pack://application:,,,/Pictures/20250609_2248_Druid of Wisdom_remix_01jxbvq7fqes28e3mcwwzftdsz.png" 
                                               Stretch="UniformToFill" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5"/>
                                        
                                        <!-- Scores on Right -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="5">
                                            <!-- Base Score Display -->
                                            <Border Background="{DynamicResource PrimaryRed}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                    BorderThickness="2" Width="100" Height="70" CornerRadius="6" Margin="0,0,0,10">
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="Base" FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center" Opacity="0.8"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.AbilityScores.Wisdom, FallbackValue='—'}" 
                                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                            
                                            <!-- Modifier Sources Display -->
                                            <StackPanel Orientation="Vertical" Width="100">
                                                <!-- Species Enhancement Display -->
                                                <Border BorderBrush="#8A2BE2" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#F5E8FF"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.WisdomSpeciesBonus}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="Species" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#8A2BE2" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.WisdomSpeciesBonus, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#8A2BE2" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- Background Enhancement Display -->
                                                <Border BorderBrush="#2E8B57" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#E8F5E8"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.WisdomBackgroundBonus}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="Background" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#2E8B57" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.WisdomBackgroundBonus, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#2E8B57" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- ASI Enhancement Display -->
                                                <Border BorderBrush="#FF6347" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#FFF0E8"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.WisdomASI}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.WisdomASI}" Value="{x:Null}">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="ASI" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#FF6347" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.WisdomASI, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#FF6347" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                            
                                            <!-- Final Score Display -->
                                            <Border Background="#FFD700" BorderBrush="#B8860B" BorderThickness="2" Width="100" Height="60" CornerRadius="6">
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="Final" FontFamily="Garamond" FontSize="12" FontWeight="Bold"
                                                               Foreground="#8B4513" HorizontalAlignment="Center" Opacity="0.8"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.WisdomTotal, FallbackValue='—'}" 
                                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                                               Foreground="#8B4513" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                                
                                <!-- Charisma -->
                                <Border Grid.Row="2" Grid.Column="1">
                                    <Border.Style>
                                        <Style TargetType="Border" BasedOn="{StaticResource AbilityPanelStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CurrentCharacter.HasGeneratedAbilityScores}" Value="False">
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="1*"/>
                                            <ColumnDefinition Width="2*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Image on Left -->
                                        <Image Grid.Column="0" Source="pack://application:,,,/Pictures/20250609_2252_Charismatic Bard Illustration_remix_01jxbvytbxfbqtw1xqjhaez6t6.png" 
                                               Stretch="UniformToFill" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5"/>
                                        
                                        <!-- Scores on Right -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="5">
                                            <!-- Base Score Display -->
                                            <Border Background="{DynamicResource PrimaryRed}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                    BorderThickness="2" Width="100" Height="70" CornerRadius="6" Margin="0,0,0,10">
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="Base" FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center" Opacity="0.8"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.AbilityScores.Charisma, FallbackValue='—'}" 
                                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                            
                                            <!-- Modifier Sources Display -->
                                            <StackPanel Orientation="Vertical" Width="100">
                                                <!-- Species Enhancement Display -->
                                                <Border BorderBrush="#8A2BE2" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#F5E8FF"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.CharismaSpeciesBonus}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="Species" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#8A2BE2" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.CharismaSpeciesBonus, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#8A2BE2" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- Background Enhancement Display -->
                                                <Border BorderBrush="#2E8B57" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#E8F5E8"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.CharismaBackgroundBonus}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="Background" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#2E8B57" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.CharismaBackgroundBonus, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#2E8B57" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- ASI Enhancement Display -->
                                                <Border BorderBrush="#FF6347" BorderThickness="2" Width="100" Height="35" CornerRadius="4" Margin="0,0,0,5">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#FFF0E8"/>
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.CharismaASI}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding CurrentCharacter.CharismaASI}" Value="{x:Null}">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <StackPanel VerticalAlignment="Center">
                                                        <TextBlock Text="ASI" FontFamily="Garamond" FontSize="10" FontWeight="Bold"
                                                                   Foreground="#FF6347" HorizontalAlignment="Center" Opacity="0.8"/>
                                                        <TextBlock Text="{Binding CurrentCharacter.CharismaASI, StringFormat='+{0}'}" 
                                                                   FontFamily="Garamond" FontSize="14" FontWeight="Bold"
                                                                   Foreground="#FF6347" HorizontalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                            </StackPanel>
                                            
                                            <!-- Final Score Display -->
                                            <Border Background="#FFD700" BorderBrush="#B8860B" BorderThickness="2" Width="100" Height="60" CornerRadius="6">
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="Final" FontFamily="Garamond" FontSize="12" FontWeight="Bold"
                                                               Foreground="#8B4513" HorizontalAlignment="Center" Opacity="0.8"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.CharismaTotal, FallbackValue='—'}" 
                                                               FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                                               Foreground="#8B4513" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </Grid>
                    </ScrollViewer>
                </Grid>
            </TabItem>

            <!-- Character Stats Tab -->
            <TabItem Header="📊 Character Stats" Style="{StaticResource MedievalTabItemStyle}" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch">
                <!-- Medieval Background -->
                <Grid Background="{DynamicResource MedievalBackground}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <Border Grid.Row="0" Background="{DynamicResource PrimaryRed}" Padding="20,15" Margin="0,0,0,20">
                                <Border BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="1">
                                    <TextBlock Text="⚔️ Character Statistics &amp; Combat Info ⚔️" FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                               Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center"/>
                                </Border>
                            </Border>
                            
                            <Grid Grid.Row="1" Margin="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                                <!-- Left Column -->
                                <StackPanel Grid.Column="0" Margin="0,0,20,0">
                                    <TextBlock Text="⚔️ Combat Statistics" Style="{DynamicResource MedievalLabelStyle}" 
                                              FontSize="20" HorizontalAlignment="Center" Margin="0,0,0,20"/>

                                    <!-- Armor Class Section -->
                                    <Border Style="{DynamicResource MedievalPanelStyle}" Background="White" 
                                           BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="2" Margin="0,0,0,15">
                                        <StackPanel>
                                            <TextBlock Text="🛡️ Armor Class" Style="{DynamicResource MedievalLabelStyle}" 
                                                      HorizontalAlignment="Center" Margin="0,0,0,15"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                                    <TextBlock Text="Calculated AC: " Style="{DynamicResource MedievalLabelStyle}" FontSize="14"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.CalculatedArmorClass}" FontFamily="Garamond" 
                                                              FontWeight="Bold" Foreground="{DynamicResource PrimaryRed}" FontSize="16"/>
                                                    <TextBlock Text=" (10 + Dex modifier)" FontFamily="Garamond" FontStyle="Italic" 
                                                              Foreground="{DynamicResource PrimaryRed}" Opacity="0.7" Margin="5,0,0,0"/>
                                                </StackPanel>
                                                <TextBox Grid.Column="1" Text="{Binding CurrentCharacter.ArmorClass}" 
                                                         Style="{DynamicResource MedievalTextBoxStyle}" Width="80" Margin="10,0"/>
                                                <Button Grid.Column="2" Content="⚔️ Apply Calculated AC" 
                                                        Style="{DynamicResource MedievalButtonStyle}" FontSize="12" Padding="12,6"
                                                        Click="ApplyCalculatedArmorClass_Click"/>
                                            </Grid>
                                        </StackPanel>
                        </Border>

                                    <!-- Hit Points Section -->
                                    <Border Style="{DynamicResource MedievalPanelStyle}" Background="White" 
                                           BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="2" Margin="0,0,0,15">
                                        <StackPanel>
                                            <TextBlock Text="❤️ Hit Points" Style="{DynamicResource MedievalLabelStyle}" 
                                                      HorizontalAlignment="Center" Margin="0,0,0,15"/>
                                
                                            <!-- Calculated Max HP Display -->
                                            <Grid Margin="0,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                                    <TextBlock Text="Calculated Max HP: " Style="{DynamicResource MedievalLabelStyle}" FontSize="14"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.CalculatedMaxHitPoints}" FontFamily="Garamond" 
                                                              FontWeight="Bold" Foreground="{DynamicResource PrimaryRed}" FontSize="16"/>
                                                    <TextBlock Text="{Binding CurrentCharacter.HitPointCalculationMethodDescription, StringFormat=' ({0})'}" 
                                                              FontFamily="Garamond" FontStyle="Italic" Foreground="{DynamicResource PrimaryRed}" 
                                                              Opacity="0.7" Margin="5,0,0,0"/>
                                                </StackPanel>
                                                <Button Grid.Column="1" Content="❤️ Apply Calculated HP" 
                                                        Style="{DynamicResource MedievalButtonStyle}" FontSize="12" Padding="12,6"
                                                        Click="ApplyCalculatedHitPoints_Click"/>
                                            </Grid>
                                
                                            <!-- Current HP Input -->
                                            <Grid Margin="0,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="Current Hit Points" Style="{DynamicResource MedievalLabelStyle}" FontSize="14" 
                                                          VerticalAlignment="Center"/>
                                                <TextBox Grid.Column="1" Text="{Binding CurrentCharacter.HitPoints}" 
                                                         Style="{DynamicResource MedievalTextBoxStyle}" Width="80"/>
                                            </Grid>

                                            <!-- Max HP Input -->
                                            <Grid Margin="0,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="Max Hit Points" Style="{DynamicResource MedievalLabelStyle}" FontSize="14" 
                                                          VerticalAlignment="Center"/>
                                                <TextBox Grid.Column="1" Text="{Binding CurrentCharacter.MaxHitPoints}" 
                                                         Style="{DynamicResource MedievalTextBoxStyle}" Width="80"/>
                                            </Grid>
                            </StackPanel>
                        </Border>

                                    <!-- Speed Section -->
                                    <Border Style="{DynamicResource MedievalPanelStyle}" Background="White" 
                                           BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="2" Margin="0,0,0,15">
                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="🏃 Speed" Style="{DynamicResource MedievalLabelStyle}" FontSize="14" 
                                                      VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="{Binding CurrentCharacter.Speed, StringFormat='{}{0} ft'}" 
                                                       FontFamily="Garamond" FontWeight="Bold" Foreground="{DynamicResource PrimaryRed}" 
                                                       FontSize="16" VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                </StackPanel>

                                <!-- Right Column -->
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="⭐ Experience &amp; Progression" Style="{DynamicResource MedievalLabelStyle}" 
                                              FontSize="20" HorizontalAlignment="Center" Margin="0,0,0,20"/>

                                    <!-- Experience Points Section -->
                                    <Border Style="{DynamicResource MedievalPanelStyle}" Background="White" 
                                           BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="2" Margin="0,0,0,15">
                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="💰 Experience Points" Style="{DynamicResource MedievalLabelStyle}" FontSize="14" 
                                                      VerticalAlignment="Center"/>
                                            <TextBox Grid.Column="1" Text="{Binding CurrentCharacter.ExperiencePoints}" 
                                                     Style="{DynamicResource MedievalTextBoxStyle}" Width="100"/>
                                        </Grid>
                                    </Border>

                                    <!-- Proficiency Bonus Section -->
                                    <Border Style="{DynamicResource MedievalPanelStyle}" Background="White" 
                                           BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="2" Margin="0,0,0,15">
                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="🎯 Proficiency Bonus" Style="{DynamicResource MedievalLabelStyle}" FontSize="14" 
                                                      VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="{Binding CurrentCharacter.ProficiencyBonus, StringFormat='+{0}'}" 
                                                       FontFamily="Garamond" FontWeight="Bold" Foreground="{DynamicResource PrimaryRed}" 
                                                       FontSize="16" VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                </StackPanel>
                            </Grid>
                </Grid>
            </TabItem>

            <!-- Features Tab (Character Choices) -->
            <TabItem Header="⚔️ Features" Style="{StaticResource MedievalTabItemStyle}"
                     HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch"
                     IsEnabled="{Binding FeaturesTabEnabled}">
                <Grid Background="{DynamicResource MedievalBackground}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <Border Grid.Row="0" Background="{DynamicResource PrimaryRed}" Padding="20,15" Margin="0,0,0,20">
                        <Border BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="⚔️ Character Feature Choices" FontFamily="Garamond" FontSize="24" FontWeight="Bold"
                                           Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center"/>
                                <TextBlock Text="Make character-defining choices based on your class levels and abilities" 
                                           FontFamily="Garamond" FontSize="14" FontStyle="Italic"
                                           Foreground="{DynamicResource PrimaryGold}" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>
                    </Border>

                    <!-- Progress Summary -->
                    <Border Grid.Row="1" Style="{DynamicResource MedievalPanelStyle}" Background="White" Margin="10,0,10,20">
                        <StackPanel>
                            <TextBlock Text="📊 Progress Summary" Style="{StaticResource MedievalLabelStyle}" FontSize="18" HorizontalAlignment="Center"/>
                            <TextBlock Text="{Binding FeaturesViewModel.ProgressSummary}" FontFamily="Garamond" FontSize="14" 
                                       HorizontalAlignment="Center" Margin="0,5,0,0" Foreground="{DynamicResource PrimaryRed}"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                                <Button Content="🔄 Refresh Choices" Style="{StaticResource MedievalButtonStyle}" 
                                        Command="{Binding FeaturesViewModel.RefreshChoicesCommand}" FontSize="12" Padding="10,5"/>
                                <Button Content="🗑️ Reset All" Style="{StaticResource MedievalButtonStyle}" 
                                        Command="{Binding FeaturesViewModel.ResetAllChoicesCommand}" FontSize="12" Padding="10,5"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Feature Choices Content -->
                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Margin="10,0,10,0">
                        <StackPanel>
                            <!-- Subclass Choices -->
                            <Border Style="{DynamicResource MedievalPanelStyle}" Background="White" Margin="0,0,0,15"
                                    Visibility="{Binding FeaturesViewModel.SubclassChoices.Count, Converter={StaticResource ValueToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="🏰 Subclass Choices" Style="{StaticResource MedievalLabelStyle}" FontSize="18"/>
                                    <ItemsControl ItemsSource="{Binding FeaturesViewModel.SubclassChoices}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource ControlBackground}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                        BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,5,0,5">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Name}" FontFamily="Garamond" FontWeight="Bold" FontSize="16"/>
                                                        <TextBlock Text="{Binding ClassName, StringFormat='Class: {0}'}" FontFamily="Garamond" FontSize="12" 
                                                                   Foreground="{DynamicResource PrimaryRed}" FontStyle="Italic"/>
                                                        <TextBlock Text="{Binding Level, StringFormat='Level: {0}'}" FontFamily="Garamond" FontSize="12" 
                                                                   Foreground="{DynamicResource PrimaryRed}" FontStyle="Italic"/>
                                                        <TextBlock Text="{Binding Description}" TextWrapping="Wrap" FontFamily="Garamond" FontSize="12" 
                                                                   Margin="0,5,0,10"/>
                                                        <ComboBox ItemsSource="{Binding AvailableSubclasses}" 
                                                                  SelectedItem="{Binding SelectedSubclass, Mode=TwoWay}"
                                                                  DisplayMemberPath="Name"
                                                                  Style="{StaticResource MedievalComboBoxStyle}"
                                                                  FontSize="12"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>

                            <!-- Ability Score Improvement Choices -->
                            <Border Style="{DynamicResource MedievalPanelStyle}" Background="White" Margin="0,0,0,15"
                                    Visibility="{Binding FeaturesViewModel.AbilityScoreImprovementChoices.Count, Converter={StaticResource ValueToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="📈 Ability Score Improvements" Style="{StaticResource MedievalLabelStyle}" FontSize="18"/>
                                    <ItemsControl ItemsSource="{Binding FeaturesViewModel.AbilityScoreImprovementChoices}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource ControlBackground}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                        BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,5,0,5">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Name}" FontFamily="Garamond" FontWeight="Bold" FontSize="16"/>
                                                        <TextBlock Text="{Binding ClassName, StringFormat='Class: {0} (Level {1})'}" FontFamily="Garamond" FontSize="12" 
                                                                   Foreground="{DynamicResource PrimaryRed}" FontStyle="Italic"/>
                                                        <TextBlock Text="Choose to improve ability scores or select a feat (if allowed)" 
                                                                   TextWrapping="Wrap" FontFamily="Garamond" FontSize="12" Margin="0,5,0,10"/>
                                                        <CheckBox Content="Choose Feat Instead" IsChecked="{Binding ChooseFeat, Mode=TwoWay}"
                                                                  Visibility="{Binding CanChooseFeat, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                                  FontFamily="Garamond" FontSize="12" Margin="0,0,0,10"/>
                                                        <!-- Feat selection would go here when ChooseFeat is true -->
                                                        <!-- Ability score selection would go here when ChooseFeat is false -->
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>

                            <!-- Combat Style Choices -->
                            <Border Style="{DynamicResource MedievalPanelStyle}" Background="White" Margin="0,0,0,15"
                                    Visibility="{Binding FeaturesViewModel.CombatStyleChoices.Count, Converter={StaticResource ValueToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="⚔️ Combat Styles" Style="{StaticResource MedievalLabelStyle}" FontSize="18"/>
                                    <ItemsControl ItemsSource="{Binding FeaturesViewModel.CombatStyleChoices}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource ControlBackground}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                        BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,5,0,5">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Name}" FontFamily="Garamond" FontWeight="Bold" FontSize="16"/>
                                                        <TextBlock Text="{Binding ClassName, StringFormat='Class: {0} (Level {1})'}" FontFamily="Garamond" FontSize="12" 
                                                                   Foreground="{DynamicResource PrimaryRed}" FontStyle="Italic"/>
                                                        <ComboBox ItemsSource="{Binding AvailableStyles}" 
                                                                  SelectedItem="{Binding SelectedStyle, Mode=TwoWay}"
                                                                  DisplayMemberPath="Name"
                                                                  Style="{StaticResource MedievalComboBoxStyle}"
                                                                  FontSize="12" Margin="0,10,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>

                            <!-- Magical Feature Choices (Maneuvers, Metamagic, Invocations, etc.) -->
                            <Border Style="{DynamicResource MedievalPanelStyle}" Background="White" Margin="0,0,0,15"
                                    Visibility="{Binding FeaturesViewModel.MagicalFeatureChoices.Count, Converter={StaticResource ValueToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="✨ Magical Features" Style="{StaticResource MedievalLabelStyle}" FontSize="18"/>
                                    <ItemsControl ItemsSource="{Binding FeaturesViewModel.MagicalFeatureChoices}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource ControlBackground}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                        BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,5,0,5">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Name}" FontFamily="Garamond" FontWeight="Bold" FontSize="16"/>
                                                        <TextBlock Text="{Binding ClassName, StringFormat='Class: {0} (Level {1})'}" FontFamily="Garamond" FontSize="12" 
                                                                   Foreground="{DynamicResource PrimaryRed}" FontStyle="Italic"/>
                                                        <TextBlock Text="{Binding FeatureType, StringFormat='Type: {0}'}" FontFamily="Garamond" FontSize="12" 
                                                                   Foreground="{DynamicResource PrimaryRed}" FontStyle="Italic"/>
                                                        <TextBlock Text="{Binding NumberToChoose, StringFormat='Choose {0}:'}" FontFamily="Garamond" FontSize="12" 
                                                                   Margin="0,5,0,5"/>
                                                        <ListBox ItemsSource="{Binding AvailableFeatures}" 
                                                                 Height="120" Margin="0,5,0,5"
                                                                 Background="White" BorderBrush="{DynamicResource PrimaryGold}">
                                                            <ListBox.ItemTemplate>
                                                                <DataTemplate>
                                                                    <StackPanel Margin="5">
                                                                        <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="14"/>
                                                                        <TextBlock Text="{Binding Description}" TextWrapping="Wrap" FontSize="12" 
                                                                                   Foreground="DarkBlue" Margin="0,2,0,0"/>
                                                                        <TextBlock Text="{Binding Prerequisites}" FontSize="10" FontStyle="Italic" 
                                                                                   Foreground="Gray" Margin="0,2,0,0"
                                                                                   Visibility="{Binding Prerequisites, Converter={StaticResource StringToVisibilityConverter}}"/>
                                                                    </StackPanel>
                                                                </DataTemplate>
                                                            </ListBox.ItemTemplate>
                                                        </ListBox>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>

                            <!-- Skills/Tools Choices -->
                            <Border Style="{DynamicResource MedievalPanelStyle}" Background="White" Margin="0,0,0,15"
                                    Visibility="{Binding FeaturesViewModel.SkillsToolsChoices.Count, Converter={StaticResource ValueToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="🛠️ Skills &amp; Tools" Style="{StaticResource MedievalLabelStyle}" FontSize="18"/>
                                    <ItemsControl ItemsSource="{Binding FeaturesViewModel.SkillsToolsChoices}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource ControlBackground}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                        BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,5,0,5">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Name}" FontFamily="Garamond" FontWeight="Bold" FontSize="16"/>
                                                        <TextBlock Text="{Binding ClassName, StringFormat='Class: {0} (Level {1})'}" FontFamily="Garamond" FontSize="12" 
                                                                   Foreground="{DynamicResource PrimaryRed}" FontStyle="Italic"/>
                                                        <TextBlock Text="{Binding NumberToChoose, StringFormat='Choose {0} options:'}" FontFamily="Garamond" FontSize="12" 
                                                                   Margin="0,5,0,5"/>
                                                        <!-- Skills -->
                                                        <TextBlock Text="Skills:" FontFamily="Garamond" FontWeight="Bold" FontSize="12" 
                                                                   Visibility="{Binding CanChooseSkills, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                        <ItemsControl ItemsSource="{Binding AvailableSkills}" 
                                                                      Visibility="{Binding CanChooseSkills, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <ItemsControl.ItemsPanel>
                                                                <ItemsPanelTemplate>
                                                                    <WrapPanel/>
                                                                </ItemsPanelTemplate>
                                                            </ItemsControl.ItemsPanel>
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <CheckBox Content="{Binding}" Margin="5,2" FontSize="12"/>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                        <!-- Tools -->
                                                        <TextBlock Text="Tools:" FontFamily="Garamond" FontWeight="Bold" FontSize="12" 
                                                                   Visibility="{Binding CanChooseTools, Converter={StaticResource BooleanToVisibilityConverter}}" 
                                                                   Margin="0,10,0,0"/>
                                                        <ItemsControl ItemsSource="{Binding AvailableTools}" 
                                                                      Visibility="{Binding CanChooseTools, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <ItemsControl.ItemsPanel>
                                                                <ItemsPanelTemplate>
                                                                    <WrapPanel/>
                                                                </ItemsPanelTemplate>
                                                            </ItemsControl.ItemsPanel>
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <CheckBox Content="{Binding}" Margin="5,2" FontSize="12"/>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>

                            <!-- Creature Type Choices -->
                            <Border Style="{DynamicResource MedievalPanelStyle}" Background="White" Margin="0,0,0,15"
                                    Visibility="{Binding FeaturesViewModel.CreatureTypeChoices.Count, Converter={StaticResource ValueToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="🐺 Creature Types" Style="{StaticResource MedievalLabelStyle}" FontSize="18"/>
                                    <ItemsControl ItemsSource="{Binding FeaturesViewModel.CreatureTypeChoices}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource ControlBackground}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                        BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,5,0,5">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Name}" FontFamily="Garamond" FontWeight="Bold" FontSize="16"/>
                                                        <TextBlock Text="{Binding ClassName, StringFormat='Class: {0} (Level {1})'}" FontFamily="Garamond" FontSize="12" 
                                                                   Foreground="{DynamicResource PrimaryRed}" FontStyle="Italic"/>
                                                        <ComboBox ItemsSource="{Binding AvailableCreatureTypes}" 
                                                                  SelectedItem="{Binding SelectedCreatureType, Mode=TwoWay}"
                                                                  DisplayMemberPath="Name"
                                                                  Style="{StaticResource MedievalComboBoxStyle}"
                                                                  FontSize="12" Margin="0,10,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>

                            <!-- Terrain Type Choices -->
                            <Border Style="{DynamicResource MedievalPanelStyle}" Background="White" Margin="0,0,0,15"
                                    Visibility="{Binding FeaturesViewModel.TerrainTypeChoices.Count, Converter={StaticResource ValueToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="🏔️ Terrain Types" Style="{StaticResource MedievalLabelStyle}" FontSize="18"/>
                                    <ItemsControl ItemsSource="{Binding FeaturesViewModel.TerrainTypeChoices}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource ControlBackground}" BorderBrush="{DynamicResource PrimaryGold}" 
                                                        BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,5,0,5">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Name}" FontFamily="Garamond" FontWeight="Bold" FontSize="16"/>
                                                        <TextBlock Text="{Binding ClassName, StringFormat='Class: {0} (Level {1})'}" FontFamily="Garamond" FontSize="12" 
                                                                   Foreground="{DynamicResource PrimaryRed}" FontStyle="Italic"/>
                                                        <ComboBox ItemsSource="{Binding AvailableTerrainTypes}" 
                                                                  SelectedItem="{Binding SelectedTerrainType, Mode=TwoWay}"
                                                                  DisplayMemberPath="Name"
                                                                  Style="{StaticResource MedievalComboBoxStyle}"
                                                                  FontSize="12" Margin="0,10,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{DynamicResource PrimaryRed}" Padding="15,8" 
                BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="0,2,0,0">
            <Border BorderBrush="{DynamicResource PrimaryGold}" BorderThickness="1" CornerRadius="4" Padding="10,5">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="📜 Status:" Foreground="{DynamicResource PrimaryGold}" FontFamily="Garamond" 
                               FontWeight="Bold" FontSize="12" Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding StatusMessage}" Foreground="{DynamicResource PrimaryGold}" 
                               FontFamily="Garamond" FontSize="12"/>
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</Window> 